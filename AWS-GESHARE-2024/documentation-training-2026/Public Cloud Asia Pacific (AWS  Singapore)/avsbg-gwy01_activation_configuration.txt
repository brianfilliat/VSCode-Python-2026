avsbg-gwy01
GERITM38495084\GECHG1690464
GECHG1665024 - DDI IPAM/DNS

Short Description   -    IPAM - IP Reserve 
Subnet              -    10.188.69.192/27
Location Code       -    AS-MYS-SL-SBG-47200-SAAS-AERO

avsbg-gwy01.av.ge.com			
ip address:	10.188.69.197
netmask:	255.255.255.224
gateway:	10.188.69.192


av-storage-gateway-subang-apsoutheast
vpce-06acb78fddf868095-zm9bqmgg.storagegateway.ap-southeast-1.vpce.amazonaws.com
SGW VPC EP: vpce-06acb78fddf868095-zm9bqmgg.storagegateway.ap-southeast-1.vpce.amazonaws.com   [10.212.137.23 | 10.212.136.215]
S3  VPC EP: vpce-088032eb00bbac191-10g7bcd5.s3.ap-southeast-1.vpce.amazonaws.com   [10.212.137.118 | 10.212.136.244]
ap-southeast-1

Tags
env		prod
name	av-storage-gateway-subang-apsoutheast
uai		uai3055434

Step 1	Pull down latest OVA from AWS for an Amazon S3 File Gateway

The following is what you need to browse to

Click on the following link
	http://sc.ge.com/*AWSEntLoginMFA
	Select Account: aviation-cto-ap-p (535452874611)

Download the latest OVF and you want to download the latest from the region/account the SGW will be running

Pull up the Service Storage Gateway 

Click on Create gateway > Scroll down to 'Platform options' with Host platform VMware ESXi > Click on 'Download OVF template'

File downloaded will be 'aws-storage-gateway-latest.ova' it will be 2.4GB in size
This will be the file you will need to use to create the SGW Virtual Appliance in vCenter
When the download is completed, just scroll to the bottom of the page and click 'Cancel' then just click 'Leave' on the next page

Step 2	Build a new VM from the OVA that was downloaded

Since the ESXi hosts are in the non-vault at Subang the VM will be built on the non-vaulted instance of vcenter
You only can build the new VM and add cache disk

# Note: The SGW was already built

VDC Non-Vault
https://vdc-amer.ics.cloud.ge.com/

Locate the Cluster 'AVSubang-Vitality' right click then click on 'Deploy OVF Template'
On the Deploy OVF Template select 'Local File' then click on 'UPLOAD FILES' locate the OVF you downloaded and select it then click 'NEXT'
Virtual machine name 'avsbg-gwy01'
Select a name and folder 'AVSubang-Vitality' and the folder 'Storage Gateway'
Select a compute resource 'rsoesxsbg01.corporate.ge.com' and click 'NEXT'
Review details click 'NEXT'
Select Storage click on the Datastore with the most free TB and click 'NEXT'
Select networks 'vlan312' click 'NEXT'
Ready to complete Click FINISH

Now watch the progress bars for 'Import OVF package' and 'Deploy OVF template and wait until completed

Step 3	Configure avsbg-gwy01 to be a medium AWS Storage Gateway

CPUs total = 8
CPU sockets = 2
CPU shares = High
CPU Reservation = 10 GHz
Memory = 32 GB
Memory shares = High
Memory Reservation = 16 GB
Hard disk 1 aka Root Hard Disk = 160 GB
Cache Disk 1 = 500 GB
Cache Disk 2 = 500 GB
numa.vcpu.min = 8
numa.autosize.vcpu.maxPerVirtualNode = 8
GatewayCapacity (metadata cache) = Medium
numa.autosize.cookie =  80001

Step 4	Power on VM and console into it to configure network settings and services

HTTP/SOCKS Proxy Configuration = N/A
Port for existing HTTP proxy = N/A
Adapter eth0 IP Address = 10.188.69.197
Netmask = 255.255.255.224
Gateway = 10.188.69.192
DNS = 10.220.220.220 & 10.220.220.221
NTP = ntp1.ge.com & ntp2.ge.com

Step 5	Test the network connectivity to the AWS

At the Enter command: <select 3> "Test Network Connectivity then <select 1 - 'AWS Storage Gateway> then <select 2 - 'VPC (PrivateLink) then enter
VPC endpoint (DNS/IP) = 10.212.137.23
Enter region = ap-southeast-1

Note: Tested the connectivity and it passed

Step 6	Activate the AWS Appliance

Activation is a 4 step process via the AWS Storage Gateway GUI
Step 1 Setup gateway
Step 2 Connect to AWS
Step 3 Review and activate
Step 4 Configure Gateway

Activate the newl Storage Gateway via the AWS Storage Gateway GUI in Region ap-southeast-1
# Click on the following link
	http://sc.ge.com/*AWSEntLoginMFA
	Select Account: aviation-cto-ap-p (535452874611)
Ensure from the upper right bar pull down you are Asia Pacific (Singapore) ap-southeast-1

Activation is a 4 step process via the AWS Storage Gateway GUI
# Step 1 Setup gateway
# Step 2 Connect to AWS
# Step 3 Review and activate
# Step 4 Configure Gateway
# Step 5 Configure Metadata cache settings via AWS CLI

Click on the orange box [Create gateway]

In Gateway settings paste in the the following Gateway name:
av-storage-gateway-subang-apsoutheast
For Gateway time zone select the following:
GMT +5:30 Bombay, Calcutta, Madras, New Delh
In Gateway options select Gateway Type
Amazon S3 File Gateway
In Platform options select Host platform
VMware ESxi
In Set up gateway on VMware ESXi click the box Confirm set up gateway
'I downloaded the OVF template and completed the deployment and then followed all the steps above.'
Click Next

In the Connect to AWS page
Gateway connection options select IP Address
In the IP address type in 10.188.69.197

In the Endpoint options select the Service endpoint as VPC hosted
Select VPC endpoint DNS name or IP address
In the VPC endpoint DNS name or IP address box paste in:
vpce-06acb78fddf868095-zm9bqmgg.storagegateway.ap-southeast-1.vpce.amazonaws.com
Click Next

On the Review and activate page do a check to ensure all the settings 
Click Next

Next screen is Configure Gateway
Be patient, it will take time for the SGW to see the Cache Disk
When the cache disk is discovered select it 
Further down the page select all the default recommended AWS Alarms

On the SGW GUI page click on the newly created SGW
Locate and click on Tags and then click Manage
Add the following Tags
	env		prod
	name	av-storage-gateway-subang-apsoutheast
	uai		uai3055434
	
document the newly created SGW ARN
arn:aws:storagegateway:ap-southeast-1:535452874611:gateway/sgw-8DEC07E4
	
The uai code can be found at the following link for International Sites
https://devcloud.swcoe.ge.com/devspace/display/IQVAG/2.+Aerospace+Hybrid+Cloud


Step 7	Register the new sgw-E604EE8F in ARS under the LOGON Domain

https://ars.tools.ds.ge.com/ARS/

-----------------------------------------------------------------------
lg821834sv - contact 502636801 for password          (Non-Vault login)
-----------------------------------------------------------------------

locate the Search option and click on it and search for unclaimed
check on the box for the the In Folder [logon.ds.ge.com]
then click on New Server under the far right unclaimed folder

the next page is New Server in unclaimed [Active Directory  logon.ds.ge.com  Enterprise  Computers  unclaimed]
type in th Name block
	SGW-8DEC07E4
Then click Next

Fill in the following fields only!

	GEHRINDUSTRYGROUPID:	1178320
	GEPOLE:					ASPAC
	GEVSVRTYPE:				UNX
	GEVSVRENVIRONMENT:		Production
	GEVSVRFUNCTION:			Storage_Filer
	GEVSVRSUPPORTEDBY:		GE001000000

Then click Finish
Double check to ensure it all took by searching for SGW-xxxxxx
Select it and browse to the Object info and document
logon.ds.ge.com/Enterprise/Computers/GE001000000/Infrastructure/SGW-8DEC07E4
CN=SGW-8DEC07E4,OU=Infrastructure,OU=GE001000000,OU=Computers,OU=Enterprise,DC=logon,DC=ds,DC=ge,DC=com

Step 8	Configure SGW Active Directory Settings

Have the SGW logon into the AD Domain logon.ds.ge.com via the AWS Storage Gateway GUI
Select av-storage-gateway-62loyang-02-apsoutheast and locate Actions > Edit SMB settings > Edit Active Directory settings

Domain name:		logon.ds.ge.com
Domain user:		lg821834sv
Domain password:	contact 502636801 for password

then click next and watch the Join Domain Request
you should observe [Successfully updated the domain information in Active Directory settings.]

------------------------------------ Step 4 --------------------------------------------

# Configure Metadata cache settings via AWS CLI via AWS Click
# This is done via Gossamer3 and bypassing the proxy
# Using Powershell WSL (aka Ubuntu)

set http_proxy=http://PITC-Zscaler-Americas-Cincinnati3PR.proxy.corporate.ge.com:80
set https_proxy=http://PITC-Zscaler-Americas-Cincinnati3PR.proxy.corporate.ge.com:80
gossamer3 login -a pub-ap
? Please choose the role  [Use arrows to move, type to filter]

  Account: aviation-cto-ap-p (535452874611) / av-cbts-storage-gateway

# Set the metadata cache to medium and then check that the settings took
aws --profile saml storagegateway update-gateway-information --gateway-arn arn:aws:storagegateway:ap-southeast-1:535452874611:gateway/sgw-8DEC07E4 --gateway-capacity Medium
aws --profile saml storagegateway describe-gateway-information --gateway-arn arn:aws:storagegateway:ap-southeast-1:535452874611:gateway/sgw-8DEC07E4